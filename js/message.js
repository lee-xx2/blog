"use strict";function getReply(e,n){$.ajax({url:"../php/reply/getReply.php",data:{msg_id:e},success:function(e){var t="";(e=JSON.parse(e)).forEach(function(e){t+='    <div class="item_reply" index="'+e.id+'">\n        <p> <span class="friend_name">'+e.user_name+"</span>评论了你：\n     <span>"+e.info+"</span>\n    </p>\n      </div>"}),t+='<button class="re_btn">发表评论</button>',n.find(".reply")[0].innerHTML=t,n.find(".reply").slideToggle(500)}})}function render(e){var t='<div class="tit_show">评论</div>';e.forEach(function(e){t+='\n    <div class="li_show" ind='+e.id+'>\n    \x3c!-- 头部 --\x3e\n    <div class="head_show">\n      <img src="../image/fg3.jpg" alt="">\n      <span>'+e.user_name+"</span>\n      <span>"+e.release_date+'</span>\n    </div>\n    \x3c!-- 内容区域 --\x3e\n    <p class="con">\n      '+e.msg+'\n    </p>\n    \x3c!-- 点赞区域 回复 --\x3e\n    <div class="foot_show">\n      <i class="iconfont icon-praise up" cot=\''+e.up_num+'\'></i>\n      <span class="up_num">'+(0==e.up_num?"":e.up_num)+'</span>\n      <span class="replybtn">评论</span>\n      <span class="delete">删除</span>\n    </div>\n    <div class="reply">              \n    </div>\n  </div>'}),$(".show")[0].innerHTML=t}$(document).ready(function(){document.querySelector("body").setAttribute("page",1),getMsg(1,2)}),$(".oButton").click(function(){if($.cookie("login"))if($(".msg")[0].value){var e=format(new Date);$.ajax({url:"../php/message/addMessage.php",type:"post",data:{msg:$(".msg")[0].value,user_id:$.cookie("login"),user_name:$.cookie("username"),release_date:e},success:function(e){e=JSON.parse(e),$(".tip")[0].innerHTML="发布成功",$(".tip").fadeIn(800).fadeOut(1800),getMsg(document.querySelector("body").getAttribute("page"),2),$(".msg")[0].value=""},error:function(e){console.log("请求失败")}})}else alert("请输入留言内容!");else alert("请先登录你的账号!"),window.onload.href="../html/loginAndRegist.html"}),$(".show").click(function(t){if(t.target.classList.contains("up")){var e=t.target.parentNode.parentNode.getAttribute("ind")-0,n=t.target.getAttribute("cot")-0+1;$.ajax({url:"../php/message/upMessage.php",data:{id:e,num:n},success:function(e){t.target.nextElementSibling.innerHTML=t.target.nextElementSibling.innerHTML-0+1,t.target.classList.add("clicki")}})}if(t.target.classList.contains("delete")){e=t.target.parentNode.parentNode.getAttribute("ind")-0;$.ajax({url:"../php/message/deleteMessage.php",data:{id:e},success:function(e){e=JSON.parse(e),$(".tip")[0].innerHTML="删除成功",$(".tip").fadeIn(800).fadeOut(1800),getMsg(document.querySelector("body").getAttribute("page"),2)}})}if(t.target.classList.contains("replybtn")){var a=$(t.target.parentNode.parentNode);getReply(a.attr("ind")-0,a)}if(t.target.classList.contains("re_btn"))if($.cookie("login")){$(".shadow").css("display","block"),$(".writ_reply").fadeIn(1e3);e=t.target.parentNode.parentNode.getAttribute("ind")-0;$(".writ_reply").attr("msgid",e)}else alert("请先登录账号！"),window.location.href="../html/loginAndRegist.html"}),$(".release_reply_btn").click(function(){var n=this.parentNode.getAttribute("msgid"),e=$(this.parentNode).find(".ms")[0].value;$(this.parentNode).find(".ms")[0].value="",e?$.ajax({url:"../php/reply/insertReply.php",data:{msg_id:n,info:e,user_id:$.cookie("login"),user_name:$.cookie("username")},success:function(e){e=JSON.parse(e),$(".tip")[0].innerHTML="发布成功",$(".tip").fadeIn(800).fadeOut(1800);var t=void 0;document.querySelectorAll(".li_show").forEach(function(e){e.getAttribute("ind")==n&&(t=$(e))}),getReply(n,t),t.find(".reply").slideToggle(1e3),$(".writ_reply").fadeOut(1e3),$(".shadow").css("display","none")}}):alert("请输入内容！")}),$(".close").click(function(){$(".writ_reply").fadeOut(300),$(".shadow").css("display","none")});var flag=!0;function getMsg(e,t){$.ajax({url:"../php/message/getMessage.php",type:"post",data:{index:e,length:t},success:function(e){e=JSON.parse(e),$(".m-style").pagination({totalData:e.total,showData:2,coping:!0,prevContent:"<",nextContent:">",current:document.querySelector("body").getAttribute("page")-0,callback:function(e){document.querySelector("body").setAttribute("page",e.getCurrent()),getMsg(e.getCurrent(),2)}}),render(e.list)}})}